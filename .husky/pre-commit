# Lint with Spectral (fail on errors only, warnings are allowed)
npx spectral lint spec3.yml --fail-severity=error
RESULT=$?
if [ $RESULT -ne 0 ]; then
  echo "Spectral linting failed. Commit aborted."
  exit 1
fi

node utils/validateOperationIds.js
RESULT=$?
if [ $RESULT -ne 0 ]; then
  echo "Operation ID validation failed. Commit aborted."
  exit 1
fi

node utils/yamlToJSON.js
RESULT=$?
if [ $RESULT -ne 0 ]; then
  echo "yamlToJSON.js failed. Commit aborted."
  exit 1
fi

# Stage spec3.json if it was changed
if git diff --quiet --exit-code spec3.json; then
  # No changes to spec3.json
  :
else
  git add spec3.json
fi

node utils/updateCopyright.js
RESULT=$?
if [ $RESULT -ne 0 ]; then
  echo "updateCopyright.js failed. Commit aborted."
  exit 1
fi

# Stage any changes made by updateCopyright.js
if git diff --quiet --exit-code LICENSE; then
  # No changes to LICENSE
  :
else
  git add LICENSE
fi
